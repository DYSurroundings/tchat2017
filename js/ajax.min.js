function creerXHR(){var b=null;if(window.XMLHttpRequest||window.ActiveXObject){if(window.ActiveXObject){try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){b=new ActiveXObject("Microsoft.XMLHTTP")}}else{b=new XMLHttpRequest()}}else{alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest...");return null}return b}window.addEventListener("load",init);function init(){containerOpen=false;message=document.querySelector("input.textarea");user_id=document.querySelector('input[name="user_id"]').value;username=document.querySelector("div.name").innerHTML;chat=document.querySelector("ol");form=document.querySelector("form");form.addEventListener("submit",function(a){a.preventDefault();sendMessage(this)});getLastsMessage()}function sendMessage(b){if(message.value.length>=501){alert("Votre message ne peut contenir plus de 500 caractères");return false}if(message.value.length===0){alert("Votre message ne peut être vide!");return false}b="texte="+message.value+"&user_id="+user_id+"&username="+username;var c=creerXHR();var a="ajaxCall.php";c.open("POST",a,true);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){if(c.responseText=="ok"){chat.innerHTML="";message.value="";getLastsMessage()}}};c.send(b)}function getLastsMessage(){var b=creerXHR();var a="ajaxCall.php?getLastsMessage";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){chat.innerHTML="";var d=JSON.parse(b.responseText);for(var c=(Object.keys(d).length-1);c>=0;c--){pushLastMessage(d[c].texte,d[c].login,d[c].ladate)}}};b.send()}function pushLastMessage(b,c,a){chat.innerHTML+="<li class='other'><div class='avatar'><img src='images/avatar.png' draggable='false'/></div></div><div class='msg'><p id='colorenvoie'>"+c+"</p><p>"+b+"</p><time>"+a+"</time></div></li>";window.scrollTo(0,document.body.scrollHeight+100)}function VerifNbMsg(){var b=creerXHR();var a="ajaxCount.php";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){if(b.responseText=="charge"){getLastsMessage()}}};b.send()}function openEmojiContainer(){var a=document.querySelector(".emoji-container");if(!containerOpen){containerOpen=true;a.style.display="block"}else{containerOpen=false;a.style.display="none"}}function addEmoji(a){openEmojiContainer();message.value+=" :"+a.children[0].alt+": ";message.focus()};